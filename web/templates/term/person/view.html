{% extends "term/page.html" %}

{% block content %}
<span ng-init="person.id={{person.id}};person.status={{person.status}}"></span>
<h2 class="g-color-blue m-page-name" ng-controller="PersonController">
    {{person.name}}
    <div class="right">
        <a ng-click="unbindCard(person)" 
            class="f-spot-button bg-red small">
            Отвязать карту
        </a>
        <a ng-click="removePerson(person)" 
            class="f-spot-button bg-red small">
            Удалить
        </a>
        <a ng-show="person.status"
            ng-click="lockPerson(person)" 
            class="f-spot-button bg-red small">
            Заблокировать
        </a>
        <a ng-hide="person.status"
            ng-click="lockPerson(person)" 
            class="f-spot-button bg-red small">
            Разблокировать
        </a>
    </div>
</h2>
<div class="section-container section-container__main auto" data-section="" data-options="deep_linking: true;" style=""  ng-controller="PersonController">
    <section class="section active">
        <p class="title"><a>События</a></p>
        <span ng-init="person.type={{person.type}}"></span>
        <div class="content">
            <div>
                <br />
                {% include 'term/person/wallet_form.html' %}
            </div>
            <div id="person-type"></div>
            <div class="content-row">
                <p class="m-hint">Для изменения времени начала и конца события два раза кликните по нему. </p>
            </div>
            <div class="content-row f-main-slide-link">
                <div class="toggle-active">
                    <a id="event" class="loc-link f-spot-button small">
                        + Добавить событие
                    </a>
                </div>
            </div>
            <div id="eventForm" class="slide-box slide-setting">
                {% include 'term/person/event_form.html' %}
            </div>
            <table class="m-spot-table">
                <thead>
                <tr>
                    <th>Событие</th>
                    <th>Терминал</th>
                    <th>Таймаут (сек)</th>
                </tr>
                </thead>
                <tbody>
                {% for person_event in person_events %}
                <tr class="m-t-cont-row"
                    ng-click="getPesonEventEdit({{person_event.person_id}}, {{person_event.id}})">
                    <td>{{person_event.event.name}}</td>
                    <td>{{person_event.term.name}}</td>
                    <td>{{person_event.timeout}}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

    </section>
    <section class="section" ng-controller="GeneralController">
        <span ng-init="search.limit=10;search.action_type='get_grid_content';search.action='report'"></span>
        <p class="title"><a>Транзакции</a></p>
        <div class="content">
            <table class="m-spot-table">
                <thead>
                <tr>
                    <th>Дата и время</th>
                    <th>Терминал</th>
                    <th>Событие</th>
                    <th>Сумма покупки</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="report in result" class="m-t-cont-row">
                    <td>{[{report.date}]} {[{report.time}]}</td>
                    <td>{[{report.term}]}</td>
                    <td>{[{report.event}]}</td>
                    <td>{[{report.amount}]}</td>
                </tr>
                <tr class="m-table-bottom">
                    <td colspan="10">
                        <ui-pagination 
                            cur="pagination.cur" 
                            total="pagination.total" 
                            display="{[{pagination.display}]}">
                        </ui-pagination>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

    </section>
    <section class="section">
        <p class="title"><a>Редактировать</a></p>
        <div class="content">
            {% include 'term/person/form.html' %}
        </div>
    </section>
</div>
{% endblock %}
{% block footer_script %}
<script type="text/javascript" src="/static/term/angular/term/controllers/person.js"></script>
{{ super() }}
{% endblock %} 